"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("tslib"),t=require("react"),n=require("../../../constants.js"),r=require("../../../context/TUIKitContext.js");require("react/jsx-runtime");var a=require("../../../context/TUIChatActionContext.js");require("../../../context/TUIMessageContext.js");var u=require("../../TUIMessage/utils/emojiMap.js"),s=require("./useHandleQuoteMessage.js");exports.useMessageInputText=function(o){var i=o.state,c=o.dispatch;o.focus;var l=o.textareaRef,T=o.sendUploadMessage,d=r.useTUIKitContext("useMessageInputText").tim,_=a.useTUIChatActionContext(),f=_.sendMessage,C=_.createTextMessage,S=_.operateMessage,E=s.useHandleQuoteMessage().cloudCustomData,v=["Enter","NumpadEnter"],g=t.useCallback((function(e){e.preventDefault(),e&&e.target&&c({type:n.CONSTANT_DISPATCH_TYPE.SET_TEXT,getNewText:function(t){return e.target.value}})}),[d]),p=function(t){return e.__awaiter(void 0,void 0,void 0,(function(){var r,a,s;return e.__generator(this,(function(e){switch(e.label){case 0:return null==t||t.preventDefault(),i.text?(r={payload:{text:u.formatEmojiString(i.text)}},E.messageReply&&(r.cloudCustomData=JSON.stringify(E)),a=C(r),[4,f(a)]):[2];case 1:return e.sent(),c({getNewText:function(e){return""},type:n.CONSTANT_DISPATCH_TYPE.SET_TEXT}),S(((s={})[n.MESSAGE_OPERATE.QUOTE]=null,s)),[2]}}))}))},x=t.useCallback((function(e){!(null==e?void 0:e.ctrlKey)&&v.indexOf(null==e?void 0:e.code)>-1&&13===e.keyCode&&(null==e||e.preventDefault(),p(e)),(null==e?void 0:e.ctrlKey)&&v.indexOf(null==e?void 0:e.code)>-1&&13===e.keyCode&&c({type:n.CONSTANT_DISPATCH_TYPE.SET_TEXT,getNewText:function(e){return"".concat(e,"\n")}})}),[p,c]),P=t.useCallback((function(t){return e.__awaiter(void 0,void 0,void 0,(function(){var r,a,u;return e.__generator(this,(function(e){return t.preventDefault(),t.clipboardData&&t.clipboardData.items?(r=t.clipboardData,a=r.types,u=r.items,a.find((function(e,t){var r=u[t];switch(e){case"text/plain":return r.getAsString((function(e){c({type:n.CONSTANT_DISPATCH_TYPE.SET_TEXT,getNewText:function(t){return"".concat(t).concat(e)}})})),!0;case"Files":var a=r.getAsFile();return r&&"file"===r.kind&&r.type.match(/^image\//i)&&T({file:a},n.MESSAGE_TYPE_NAME.IMAGE),!0;default:return!1}})),[2]):[2]}))}))}),[l]),A=t.useCallback((function(e){var t;c({type:n.CONSTANT_DISPATCH_TYPE.SET_TEXT,getNewText:function(t){return"".concat(t.slice(0,i.cursorPos.start)).concat(e).concat(t.slice(i.cursorPos.start))}}),c({type:n.CONSTANT_DISPATCH_TYPE.SET_CURSOR_POS,value:{start:i.cursorPos.start+e.length,end:i.cursorPos.end+e.length}}),null===(t=null==l?void 0:l.current)||void 0===t||t.focus()}),[l,i]),N=t.useCallback((function(e){var t;c({type:n.CONSTANT_DISPATCH_TYPE.SET_TEXT,getNewText:function(){return"".concat(e)}}),null===(t=null==l?void 0:l.current)||void 0===t||t.focus()}),[l]),y=t.useCallback((function(e){c({type:n.CONSTANT_DISPATCH_TYPE.SET_CURSOR_POS,value:e})}),[l]);return{handleChange:g,handleSubmit:p,handleKeyDown:x,handlePasete:P,insertText:A,setText:N,setCursorPos:y}};
