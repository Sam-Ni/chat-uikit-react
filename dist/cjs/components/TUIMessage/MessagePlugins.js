"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("tslib"),s=require("react/jsx-runtime"),n=require("react"),i=require("tim-js-sdk"),l=require("../Plugins/index.js"),o=require("../Icon/Icon.js"),a=require("../Icon/type.js"),t=require("../../context/TUIChatStateContext.js"),r=require("../../context/TUIMessageContext.js"),u=require("./hooks/useMessageHandler.js"),d=require("../../constants.js");require("date-fns");var g=require("./hooks/useMessagePluginElement.js");function c(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var h,S=c(i);!function(e){e.quote="quote",e.forward="forward",e.copy="copy",e.delete="delete",e.resend="resend",e.revoke="revoke"}(h||(h={})),exports.MessagePlugins=function(i){var c,h,p,v,M,_,m=i.plugins,T=i.showNumber,y=i.MoreIcon,f=i.config,w=n.useState(""),E=w[0],j=w[1],x=n.useRef(null),I=r.useTUIMessageContext("MessagePlugins"),C=I.message,q=I.plugin,U=t.useTUIChatStateContext("MessageBubbleWithContext").messageListRef,A=u.useMessageHandler({message:C}),N=A.handleDelMessage,P=A.handleRevokeMessage,R=A.handleReplyMessage,k=A.handleCopyMessage,b=A.handleResendMessage,G=A.handleForWardMessage,O={quote:e.__assign(e.__assign({isShow:!0},null==f?void 0:f.quote),null===(c=null==q?void 0:q.config)||void 0===c?void 0:c.quote),forward:e.__assign(e.__assign({isShow:!0},null==f?void 0:f.forward),null===(h=null==q?void 0:q.config)||void 0===h?void 0:h.forward),copy:e.__assign(e.__assign({isShow:!0,relateMessageType:[S.default.TYPES.MSG_TEXT]},null==f?void 0:f.copy),null===(p=null==q?void 0:q.config)||void 0===p?void 0:p.copy),delete:e.__assign(e.__assign({isShow:!0},null==f?void 0:f.delete),null===(v=null==q?void 0:q.config)||void 0===v?void 0:v.delete),revoke:e.__assign(e.__assign({isShow:!0},null==f?void 0:f.revoke),null===(M=null==q?void 0:q.config)||void 0===M?void 0:M.revoke),resend:e.__assign(e.__assign({isShow:!0},null==f?void 0:f.resend),null===(_=null==q?void 0:q.config)||void 0===_?void 0:_.resend)},D=g.useMessagePluginElement({children:s.jsxs("div",e.__assign({className:"message-plugin-item"},{children:[s.jsx("span",{children:"Recall"}),s.jsx(o.Icon,{width:20,height:20,type:a.IconTypes.REVOCATION})]})),handle:function(e){x.current.closeMore(),P(e)},message:C,isShow:O.revoke.isShow&&(null==C?void 0:C.status)===d.MESSAGE_STATUS.SUCCESS&&C.flow===d.MESSAGE_FLOW.OUT,relateMessageType:O.revoke.relateMessageType}),F=g.useMessagePluginElement({children:s.jsxs("div",e.__assign({className:"message-plugin-item"},{children:[s.jsx("span",e.__assign({className:"del"},{children:"Delete"})),s.jsx(o.Icon,{width:20,height:20,type:a.IconTypes.DEL})]})),handle:function(e){x.current.closeMore(),N(e)},message:C,isShow:O.delete.isShow&&(null==C?void 0:C.status)===d.MESSAGE_STATUS.SUCCESS,relateMessageType:O.delete.relateMessageType}),L=g.useMessagePluginElement({children:s.jsxs("div",e.__assign({className:"message-plugin-item"},{children:[s.jsx("span",{children:"Quote"}),s.jsx(o.Icon,{width:20,height:20,type:a.IconTypes.QUOTE})]})),handle:function(e){x.current.closeMore(),R(e)},message:C,isShow:O.quote.isShow&&(null==C?void 0:C.status)===d.MESSAGE_STATUS.SUCCESS,relateMessageType:O.quote.relateMessageType}),W=g.useMessagePluginElement({children:s.jsxs("div",e.__assign({className:"message-plugin-item"},{children:[s.jsx("span",{children:"Copy"}),s.jsx(o.Icon,{width:20,height:20,type:a.IconTypes.COPY})]})),handle:function(e){x.current.closeMore(),k(e)},message:C,isShow:O.copy.isShow&&(null==C?void 0:C.status)===d.MESSAGE_STATUS.SUCCESS,relateMessageType:O.copy.relateMessageType}),Y=g.useMessagePluginElement({children:s.jsxs("div",e.__assign({className:"message-plugin-item"},{children:[s.jsx("span",{children:"Resend"}),s.jsx(o.Icon,{width:20,height:20,type:a.IconTypes.REPLY})]})),handle:function(e){x.current.closeMore(),b(e)},message:C,isShow:O.resend.isShow&&(null==C?void 0:C.status)!==d.MESSAGE_STATUS.SUCCESS,relateMessageType:O.resend.relateMessageType}),H=[D,L,g.useMessagePluginElement({children:s.jsxs("div",e.__assign({className:"message-plugin-item"},{children:[s.jsx("span",{children:"Forward"}),s.jsx(o.Icon,{width:20,height:20,type:a.IconTypes.FORWARD})]})),handle:function(e){x.current.closeMore(),G(e)},message:C,isShow:O.forward.isShow&&(null==C?void 0:C.status)===d.MESSAGE_STATUS.SUCCESS,relateMessageType:O.forward.relateMessageType}),F,Y,W],Q=(m||(null==q?void 0:q.plugins)||H).filter((function(e){return e})),V=y||(null==q?void 0:q.MoreIcon)||s.jsx(o.Icon,{className:"icon-more",width:16,height:16,type:a.IconTypes.MORE}),B=T||(null==q?void 0:q.showNumber)||0;return(null==C?void 0:C.status)!==d.MESSAGE_STATUS.UNSEND&&s.jsx(l.Plugins,{className:"message-plugin",customClass:E,ref:x,plugins:Q,showNumber:B,MoreIcon:V,root:null==U?void 0:U.current,handleVisible:function(e){j("".concat(!e.top&&"message-plugin-top"," ").concat(!e.left&&"message-plugin-left"))}})};
