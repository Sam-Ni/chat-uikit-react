"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("tslib"),t=require("react/jsx-runtime"),n=require("react"),r=require("../../context/TUIChatStateContext.js"),u=require("../../context/TUIChatActionContext.js");require("../../context/TUIMessageContext.js");var s=require("../Icon/Icon.js"),c=require("../Icon/type.js");function a(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}function o(a){var o=a.context,i=a.message,l=a.children,d=u.useTUIChatActionContext().setAudioSource,f=r.useTUIChatStateContext("MessageAudioWithContext").audioSource,v=n.useState(0),x=v[0],p=v[1],m=n.useRef(null),j=n.useState(!1),g=j[0],h=j[1],C=n.useCallback((function(){f&&f!==(null==m?void 0:m.current)&&(f.pause(),f.currentTime=0,d(null)),(null==m?void 0:m.current)&&(m.current.paused?(m.current.play(),h(!0),d(m.current)):(m.current.pause(),_()))}),[m,f]),I=function(){h(!1)},_=function(){d(null),m.current.currentTime=0,I()};return n.useEffect((function(){return(null==m?void 0:m.current)&&(m.current.addEventListener("pause",I),m.current.addEventListener("ended",_),m.current.addEventListener("canplay",(function(){p(parseInt("".concat(m.current.duration),10))}))),function(){(null==m?void 0:m.current)&&(m.current.removeEventListener("pause",I),m.current.removeEventListener("ended",_))}}),[m]),t.jsxs("div",e.__assign({className:"message-audio"},{children:[t.jsxs("div",e.__assign({className:"message-audio-content message-audio-".concat(i.flow)},{children:[t.jsx(s.Icon,{className:"".concat(null==i?void 0:i.flow," ").concat(g?"playing":""),type:c.IconTypes.VOICE,width:16,height:16,onClick:C}),t.jsx("span",{children:"".concat(x,"s")})]})),t.jsx("audio",e.__assign({src:null==o?void 0:o.url,ref:m,controls:!0,className:"message-audio-none"},{children:t.jsx("track",{kind:"captions"})})),l]}))}var i=a(n).default.memo(o);exports.MessageAudio=function(n){return t.jsx(i,e.__assign({},n))};
