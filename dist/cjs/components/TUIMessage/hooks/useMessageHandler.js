"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("tslib"),r=require("react"),t=require("../../../constants.js"),a=require("../../../context/TUIKitContext.js");require("react/jsx-runtime");var n=require("../../../context/TUIChatActionContext.js");require("../../../context/TUIMessageContext.js");var s=require("../../Toast/index.js");exports.useMessageHandler=function(o){var i=o.message,u=o.handleError,l=n.useTUIChatActionContext(),c=l.removeMessage,d=l.editLocalmessage,v=l.operateMessage,f=l.revokeMessage,g=a.useTUIKitContext("useDeleteHandler").tim,p=r.useCallback((function(r){return e.__awaiter(void 0,void 0,void 0,(function(){var t;return e.__generator(this,(function(e){switch(e.label){case 0:if(r.preventDefault(),!(null==i?void 0:i.ID)||!g||!c)return[2];e.label=1;case 1:return e.trys.push([1,3,,4]),[4,g.deleteMessage([i])];case 2:return e.sent(),c(i),[3,4];case 3:if(t=e.sent(),!u)throw s.Toast({text:"Error deleting message",type:"error"}),new Error(t);return u({functionName:"deleteMessage",error:t}),[3,4];case 4:return[2]}}))}))}),[i]),h=r.useCallback((function(r){return e.__awaiter(void 0,void 0,void 0,(function(){var a,n;return e.__generator(this,(function(e){switch(e.label){case 0:if(r.preventDefault(),!(null==i?void 0:i.ID)||!g||!d)return[2];e.label=1;case 1:return e.trys.push([1,6,,7]),f?[4,f(i)]:[3,3];case 2:return e.sent(),[3,5];case 3:return[4,g.revokeMessage(i)];case 4:e.sent(),e.label=5;case 5:return d(i),[3,7];case 6:if(a=e.sent(),!u)throw n=i.flow===t.MESSAGE_FLOW.OUT?"The message recall exceeded the time limit (default 2 minutes)":"Error revoke Message",s.Toast({text:n,type:"error"}),new Error(a);return u({functionName:"revokeMessage",error:a}),[3,7];case 7:return[2]}}))}))}),[i]),x=r.useCallback((function(e){var r;e.preventDefault(),(null==i?void 0:i.ID)&&g&&v&&v(((r={})[t.MESSAGE_OPERATE.QUOTE]=i,r))}),[i]),m=r.useCallback((function(e){if(e.preventDefault(),navigator.clipboard)navigator.clipboard.writeText(i.payload.text);else{var r=document.createElement("textarea");document.body.appendChild(r),r.style.position="fixed",r.style.clip="rect(0 0 0 0)",r.style.top="10px",r.value=i.payload.text,r.select(),document.execCommand("copy",!0),document.body.removeChild(r)}}),[i]),M=r.useCallback((function(r){return e.__awaiter(void 0,void 0,void 0,(function(){var r,t,a;return e.__generator(this,(function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,g.resendMessage(i)];case 1:return r=e.sent(),d(null===(a=null==r?void 0:r.data)||void 0===a?void 0:a.message),[3,3];case 2:if(t=e.sent(),!u)throw s.Toast({text:t,type:"error"}),new Error(t);return u({functionName:"resendMessage",error:t}),[3,3];case 3:return[2]}}))}))}),[i]),_=r.useCallback((function(r){return e.__awaiter(void 0,void 0,void 0,(function(){var a;return e.__generator(this,(function(e){return r.preventDefault(),(null==i?void 0:i.ID)&&g&&v?(v(((a={})[t.MESSAGE_OPERATE.FORWARD]=i,a)),[2]):[2]}))}))}),[i]);return{handleDelMessage:p,handleRevokeMessage:h,handleReplyMessage:x,handleCopyMessage:m,handleResendMessage:M,handleForWardMessage:_}};
