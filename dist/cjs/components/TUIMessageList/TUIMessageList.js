"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("tslib"),t=require("react/jsx-runtime"),s=require("react"),i=require("../../context/TUIChatStateContext.js"),n=require("../../context/TUIChatActionContext.js");require("../../context/TUIMessageContext.js");var r=require("../../context/ComponentContext.js"),a=require("./hooks/useEnrichedMessageList.js"),l=require("./hooks/useMessageListElement.js"),o=require("../InfiniteScrollPaginator/InfiniteScroll.js"),c=require("../EmptyStateIndicator/EmptyStateIndicator.js");function u(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}function d(u){var d=this,g=u.messageList,h=u.highlightedMessageId,m=u.loadMore,v=u.intervalsTimer,f=u.className,I=s.useState(null),M=I[0],x=I[1],T=s.useState(!1),j=T[0],_=T[1],p=i.useTUIChatStateContext("TUIMessageList"),C=p.messageList,L=p.highlightedMessageId,S=p.isCompleted,q=p.isSameLastMessageID,E=p.messageListRef,U=p.noMore,y=p.TUIMessageListConfig,b=n.useTUIChatActionContext(),N=b.loadMore,k=b.setHighlightedMessageId,w=r.useComponentContext(),H=w.TUIMessage,A=w.EmptyStateIndicator,P=void 0===A?c.EmptyStateIndicator:A,V=h||(null==y?void 0:y.highlightedMessageId)||L,D=60*(v||(null==y?void 0:y.intervalsTimer)||30),O=a({messageList:g||(null==y?void 0:y.messageList)||C}).messageList,R=m||(null==y?void 0:y.loadMore)||N,z=l({enrichedMessageList:O,TUIMessage:H,intervalsTimer:D});return s.useEffect((function(){e.__awaiter(d,void 0,void 0,(function(){var t,s,i,n,r;return e.__generator(this,(function(e){switch(e.label){case 0:return t=null===(r=null==M?void 0:M.parentElement)||void 0===r?void 0:r.parentElement,!S&&(null==t?void 0:t.clientHeight)>=(null==M?void 0:M.clientHeight)?[4,R()]:[3,2];case 1:e.sent(),e.label=2;case 2:return!(null==M?void 0:M.children)||j&&q||(s=(null==M?void 0:M.children)||[],i=s[s.length-1],n=setTimeout((function(){null==i||i.scrollIntoView({block:"end"}),_(!0),clearTimeout(n)}),100)),[2]}}))}))}),[z,j]),s.useEffect((function(){if(V){var e=null==M?void 0:M.querySelector("[data-message-id='".concat(V,"']"));if(!e)return;var t=e.children[1].children;t[t.length-1].classList.add("high-lighted"),null==e||e.scrollIntoView({block:"center"});var s=setTimeout((function(){t[t.length-1].classList.remove("high-lighted"),clearTimeout(s),k("")}),1e3)}}),[V]),t.jsxs("div",e.__assign({className:"message-list ".concat(f," ").concat(j?"":"hide"),ref:E},{children:[U,U&&t.jsx("p",e.__assign({className:"no-more"},{children:"No More"})),t.jsx(o.InfiniteScroll,e.__assign({className:"message-list-infinite-scroll",hasMore:!0,loadMore:R,threshold:1},{children:t.jsx("ul",e.__assign({ref:x},{children:(null==z?void 0:z.length)>0?z:t.jsx(P,{listType:"message"})}))}))]}))}var g=u(s).default.memo(d);exports.TUIMessageList=function(s){return t.jsx(g,e.__assign({},s))};
