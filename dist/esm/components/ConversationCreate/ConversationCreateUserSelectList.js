import{__assign as e,__awaiter as t,__generator as r,__spreadArray as n}from"tslib";import{jsxs as i,Fragment as o,jsx as c}from"react/jsx-runtime";import{useState as a,useRef as s}from"react";import{Input as u}from"../Input/Input.js";import{Icon as l}from"../Icon/Icon.js";import{IconTypes as m}from"../Icon/type.js";import{ConversationCreateSelectView as p}from"./ConversationCreateSelectView.js";import{Avatar as d}from"../Avatar/Avatar.js";import{defaultUserAvatar as h}from"../Avatar/default.js";import{useConversationCreate as v}from"./hooks/useConversationCreate.js";import{useTUIKitContext as f}from"../../context/TUIKitContext.js";import"../../context/TUIMessageContext.js";import{PageStateTypes as C}from"./ConversationCreate.js";import{useConversation as x}from"../../hooks/useConversation.js";import{Toast as g}from"../Toast/index.js";function N(N){var j=this,k=N.isCreateGroup,I=N.selectList,b=N.setSelectList,y=N.className,A=N.conversationList,L=N.setIsCreateGroup,S=N.setConversationCreated,D=N.setPageState,w=a(""),E=w[0],T=w[1],G=f(),R=G.tim,F=G.setActiveConversation,M=a({}),P=M[0],U=M[1],z=v(R,A,(function(e){U(e)})).getFriendListSortSearchResult,H=x(R).createConversation,K=s(new Map);return i(o,{children:[c(u,{className:"tui-conversation-create-search-input",placeholder:"Search",clearable:!0,value:E,onChange:function(e){return t(j,void 0,void 0,(function(){var t,n;return r(this,(function(r){switch(r.label){case 0:return t=e.target.value,T(t),n=U,[4,z(t)];case 1:return n.apply(void 0,[r.sent()]),[2]}}))}))},prefix:c(l,{type:m.SEARCH,height:16,width:16})}),k&&c(p,{selectList:I,setSelectList:b}),!k&&i("div",e({role:"presentation",className:"tui-user",onClick:function(){L(!0),K.current.clear(),b([])}},{children:[c(l,{type:m.ADD}),c("div",e({className:"tui-user-name active"},{children:"New Group"}))]})),c("div",e({className:"tui-conversation-create ".concat(y)},{children:c("div",e({className:"tui-conversation-create-container"},{children:c("div",e({className:"tui-group-container"},{children:Object.keys(P).map((function(o){return 0!==P[o].length&&i("div",e({className:"tui-group-box"},{children:[c("div",e({className:"title"},{children:o})),P[o].map((function(a,s){var u=a.userID,l=a.nick,m=a.avatar;return i("label",e({role:"presentation",className:"tui-user tui-user-checkbox-label",htmlFor:"userChecked-".concat(o,"-").concat(u),onClick:function(e){!function(e){t(j,void 0,void 0,(function(){var t,n;return r(this,(function(r){switch(r.label){case 0:return k?[2]:(t=e.userID,[4,H("C2C".concat(t))]);case 1:return n=r.sent(),S(!1),F(n),[2]}}))}))}(a)}},{children:[c(d,{size:30,image:m||h}),c("div",e({className:"tui-user-name"},{children:l||"".concat(u)})),k&&c("input",{onChange:function(e){!function(e,t,r){void 0===r&&(r=[]);var i=t.userID,o=e.target.checked;r.forEach((function(e){e.checked=o})),o?I.push({profile:t,domList:r}):I.splice(I.findIndex((function(e){return e.profile.userID===i})),1),b(n([],I,!0))}(e,a,K.current.get(u))},type:"checkbox",ref:function(e){!function(e,t){if(t){K.current.has(e)||K.current.set(e,[]);var r=K.current.get(e);0!==r.length&&r.some((function(e){return e.id===t.id}))||r.push(t)}}(u,e)},id:"userChecked-".concat(o,"-").concat(u),className:"tui-user-checkbox"})]}),u)}))]}),o)}))}))}))})),k&&c("div",e({className:"tui-conversation-create-next-container"},{children:c("div",e({role:"presentation",className:"tui-conversation-create-next",onClick:function(){I&&0===I.length?g({text:"Participant cannot be empty.",type:"error"}):D(C.CREATE_DETAIL)}},{children:"Next"}))}))]})}export{N as ConversationCreateUserSelectList};
