import{__assign as e}from"tslib";import{jsxs as s,jsx as o}from"react/jsx-runtime";import{useState as l,useRef as i}from"react";import n from"tim-js-sdk";import{Plugins as t}from"../Plugins/index.js";import{Icon as r}from"../Icon/Icon.js";import{IconTypes as a}from"../Icon/type.js";import{useTUIChatStateContext as d}from"../../context/TUIChatStateContext.js";import{useTUIMessageContext as u}from"../../context/TUIMessageContext.js";import{useMessageHandler as c}from"./hooks/useMessageHandler.js";import{MESSAGE_STATUS as h,MESSAGE_FLOW as g}from"../../constants.js";import"date-fns";import{useMessagePluginElement as m}from"./hooks/useMessagePluginElement.js";var p;function v(p){var v,f,S,w,M,y,C=p.plugins,T=p.showNumber,E=p.MoreIcon,N=p.config,k=l(""),R=k[0],U=k[1],j=i(null),I=u("MessagePlugins"),x=I.message,b=I.plugin,q=d("MessageBubbleWithContext").messageListRef,O=c({message:x}),P=O.handleDelMessage,D=O.handleRevokeMessage,F=O.handleReplyMessage,L=O.handleCopyMessage,W=O.handleResendMessage,Y=O.handleForWardMessage,A={quote:e(e({isShow:!0},null==N?void 0:N.quote),null===(v=null==b?void 0:b.config)||void 0===v?void 0:v.quote),forward:e(e({isShow:!0},null==N?void 0:N.forward),null===(f=null==b?void 0:b.config)||void 0===f?void 0:f.forward),copy:e(e({isShow:!0,relateMessageType:[n.TYPES.MSG_TEXT]},null==N?void 0:N.copy),null===(S=null==b?void 0:b.config)||void 0===S?void 0:S.copy),delete:e(e({isShow:!0},null==N?void 0:N.delete),null===(w=null==b?void 0:b.config)||void 0===w?void 0:w.delete),revoke:e(e({isShow:!0},null==N?void 0:N.revoke),null===(M=null==b?void 0:b.config)||void 0===M?void 0:M.revoke),resend:e(e({isShow:!0},null==N?void 0:N.resend),null===(y=null==b?void 0:b.config)||void 0===y?void 0:y.resend)},Q=m({children:s("div",e({className:"message-plugin-item"},{children:[o("span",{children:"Recall"}),o(r,{width:20,height:20,type:a.REVOCATION})]})),handle:function(e){j.current.closeMore(),D(e)},message:x,isShow:A.revoke.isShow&&(null==x?void 0:x.status)===h.SUCCESS&&x.flow===g.OUT,relateMessageType:A.revoke.relateMessageType}),V=m({children:s("div",e({className:"message-plugin-item"},{children:[o("span",e({className:"del"},{children:"Delete"})),o(r,{width:20,height:20,type:a.DEL})]})),handle:function(e){j.current.closeMore(),P(e)},message:x,isShow:A.delete.isShow&&(null==x?void 0:x.status)===h.SUCCESS,relateMessageType:A.delete.relateMessageType}),B=m({children:s("div",e({className:"message-plugin-item"},{children:[o("span",{children:"Quote"}),o(r,{width:20,height:20,type:a.QUOTE})]})),handle:function(e){j.current.closeMore(),F(e)},message:x,isShow:A.quote.isShow&&(null==x?void 0:x.status)===h.SUCCESS,relateMessageType:A.quote.relateMessageType}),G=m({children:s("div",e({className:"message-plugin-item"},{children:[o("span",{children:"Copy"}),o(r,{width:20,height:20,type:a.COPY})]})),handle:function(e){j.current.closeMore(),L(e)},message:x,isShow:A.copy.isShow&&(null==x?void 0:x.status)===h.SUCCESS,relateMessageType:A.copy.relateMessageType}),H=m({children:s("div",e({className:"message-plugin-item"},{children:[o("span",{children:"Resend"}),o(r,{width:20,height:20,type:a.REPLY})]})),handle:function(e){j.current.closeMore(),W(e)},message:x,isShow:A.resend.isShow&&(null==x?void 0:x.status)!==h.SUCCESS,relateMessageType:A.resend.relateMessageType}),X=[Q,B,m({children:s("div",e({className:"message-plugin-item"},{children:[o("span",{children:"Forward"}),o(r,{width:20,height:20,type:a.FORWARD})]})),handle:function(e){j.current.closeMore(),Y(e)},message:x,isShow:A.forward.isShow&&(null==x?void 0:x.status)===h.SUCCESS,relateMessageType:A.forward.relateMessageType}),V,H,G],_=(C||(null==b?void 0:b.plugins)||X).filter((function(e){return e})),z=E||(null==b?void 0:b.MoreIcon)||o(r,{className:"icon-more",width:16,height:16,type:a.MORE}),J=T||(null==b?void 0:b.showNumber)||0;return(null==x?void 0:x.status)!==h.UNSEND&&o(t,{className:"message-plugin",customClass:R,ref:j,plugins:_,showNumber:J,MoreIcon:z,root:null==q?void 0:q.current,handleVisible:function(e){U("".concat(!e.top&&"message-plugin-top"," ").concat(!e.left&&"message-plugin-left"))}})}!function(e){e.quote="quote",e.forward="forward",e.copy="copy",e.delete="delete",e.resend="resend",e.revoke="revoke"}(p||(p={}));export{v as MessagePlugins};
