import{__awaiter as t,__generator as e}from"tslib";import{useCallback as n}from"react";import{CONSTANT_DISPATCH_TYPE as r,MESSAGE_TYPE_NAME as o,MESSAGE_OPERATE as a}from"../../../constants.js";import{useTUIKitContext as i}from"../../../context/TUIKitContext.js";import"react/jsx-runtime";import{useTUIChatActionContext as u}from"../../../context/TUIChatActionContext.js";import"../../../context/TUIMessageContext.js";import{formatEmojiString as s}from"../../TUIMessage/utils/emojiMap.js";import{useHandleQuoteMessage as c}from"./useHandleQuoteMessage.js";var l=function(l){var f=l.state,d=l.dispatch;l.focus;var p=l.textareaRef,T=l.sendUploadMessage,v=i("useMessageInputText").tim,m=u(),g=m.sendMessage,x=m.createTextMessage,y=m.operateMessage,E=c().cloudCustomData,S=["Enter","NumpadEnter"],h=n((function(t){t.preventDefault(),t&&t.target&&d({type:r.SET_TEXT,getNewText:function(e){return t.target.value}})}),[v]),C=function(n){return t(void 0,void 0,void 0,(function(){var t,o,i;return e(this,(function(e){switch(e.label){case 0:return null==n||n.preventDefault(),f.text?(t={payload:{text:s(f.text)}},E.messageReply&&(t.cloudCustomData=JSON.stringify(E)),o=x(t),[4,g(o)]):[2];case 1:return e.sent(),d({getNewText:function(t){return""},type:r.SET_TEXT}),y(((i={})[a.QUOTE]=null,i)),[2]}}))}))},D=n((function(t){!(null==t?void 0:t.ctrlKey)&&S.indexOf(null==t?void 0:t.code)>-1&&13===t.keyCode&&(null==t||t.preventDefault(),C(t)),(null==t?void 0:t.ctrlKey)&&S.indexOf(null==t?void 0:t.code)>-1&&13===t.keyCode&&d({type:r.SET_TEXT,getNewText:function(t){return"".concat(t,"\n")}})}),[C,d]),M=n((function(n){return t(void 0,void 0,void 0,(function(){var t,a,i;return e(this,(function(e){return n.preventDefault(),n.clipboardData&&n.clipboardData.items?(t=n.clipboardData,a=t.types,i=t.items,a.find((function(t,e){var n=i[e];switch(t){case"text/plain":return n.getAsString((function(t){d({type:r.SET_TEXT,getNewText:function(e){return"".concat(e).concat(t)}})})),!0;case"Files":var a=n.getAsFile();return n&&"file"===n.kind&&n.type.match(/^image\//i)&&T({file:a},o.IMAGE),!0;default:return!1}})),[2]):[2]}))}))}),[p]),_=n((function(t){var e;d({type:r.SET_TEXT,getNewText:function(e){return"".concat(e.slice(0,f.cursorPos.start)).concat(t).concat(e.slice(f.cursorPos.start))}}),d({type:r.SET_CURSOR_POS,value:{start:f.cursorPos.start+t.length,end:f.cursorPos.end+t.length}}),null===(e=null==p?void 0:p.current)||void 0===e||e.focus()}),[p,f]),w=n((function(t){var e;d({type:r.SET_TEXT,getNewText:function(){return"".concat(t)}}),null===(e=null==p?void 0:p.current)||void 0===e||e.focus()}),[p]),j=n((function(t){d({type:r.SET_CURSOR_POS,value:t})}),[p]);return{handleChange:h,handleSubmit:C,handleKeyDown:D,handlePasete:M,insertText:_,setText:w,setCursorPos:j}};export{l as useMessageInputText};
